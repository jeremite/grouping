
{% extends "layout.html" %}
{% block body %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>



<script type="text/javascript">
$(document).ready(function($)
{
	//ajax row data

  var jsonz = {{ ajax_df|tojson }};
  var ajax_data = JSON.parse(jsonz);
  var indx = {{indx|tojson}};
  var edit_col = {{edit_col|tojson}};
  var jsoncol = {{ all_used_cols|tojson }};
  var ajax_cols = JSON.parse(jsoncol);


  var jsonz_res = {{ajax_df_res|tojson}};
  var ajax_res_data = JSON.parse(jsonz_res);
  var jsoncol_res = {{ res_used_cols|tojson }};
  var ajax_res_cols = JSON.parse(jsoncol_res);

//--->	[
//--->		{fname:"Code", lname:"With Mark", email:"mark@codewithmark.com"},
//--->		{fname:"Mary", lname:"Moe", email:"mary@gmail.com"},
//--->		{fname:"John", lname:"Doe", email:"john@yahoo.com"},
//--->		{fname:"Julie", lname:"Dooley", email:"julie@gmail.com"},
//--->	]


	var random_id = function  ()
	{
		var id_num = Math.random().toString(9).substr(2,3);
		var id_str = Math.random().toString(36).substr(2);

		return id_num + id_str;
	}


	//--->create data table > start
	var tbl = '';
  //var tbl_res = '';
  var i;

  //--->var allall_used_colsvar jsonz = {{ ajax_df|tojson }};
  //--->var ajax_data = JSON.parse(jsonz);

	tbl +='<table class="table table-hover">'
		//--->create table header > start
		tbl +='<thead>';
			tbl +='<tr>';
      $.each( ajax_cols, function( index, value ){
          tbl += '<th>'+value+'</th>';
      });
			//--->tbl +='<th>First Name</th>';
			//--->tbl +='<th>Last Name</th>';
			//--->tbl +='<th>Email</th>';
			//--->tbl +='<th>Options</th>';
			tbl +='</tr>';
		tbl +='</thead>';
		//--->create table header > end


		//--->create table body > start
		tbl +='<tbody>';

			//--->create table body rows > start
			$.each(ajax_data, function(index, val) //for each row of the data
			{
				//you can replace with your database row id
				var row_id = random_id();

				//loop through ajax row data
				tbl +='<tr row_id="'+val[indx]+'">';
          $.each( ajax_cols, function( index, value ){  //for each col of the data
            if (value==edit_col){
            //console.log("PRINTEDIT",value)
            tbl +='<td ><div class="row_data" edit_type="click" col_name="'+value+'">'+val[value]+'</div></td>';
          } else {
            //console.log("PRINTNOTEDIT",value)
            tbl +='<td ><div class="not_edit" col_name="'+value+'" contentEditable="false" readonly>'+val[value]+'</div></td>';
          }
            	//--->  tbl += '<th>'+value+'</th>';
          });
						//--->tbl +='<td ><div class="row_data" edit_type="click" col_name="fname">'+val['ID']+'</div></td>';
						//--->tbl +='<td ><div class="row_data" edit_type="click" col_name="lname">'+val['category']+'</div></td>';
						//--->tbl +='<td ><div class="row_data" edit_type="click" col_name="email">'+val['year']+'</div></td>';

					//--->edit options > start

					//--->edit options > end

				tbl +='</tr>';
			});

			//--->create table body rows > end

		tbl +='</tbody>';
		//--->create table body > end

	tbl +='</table>'
	//--->create data table > end


  function create_res(ajax_res_cols,ajax_res_data){
    var tbl_res=''
  	tbl_res +='<table class="table_res table-hover">'
  		//--->create table header > start
  		tbl_res +='<thead>';
  			tbl_res +='<tr>';
        $.each( ajax_res_cols, function( index, value ){
            tbl_res += '<th>'+value+'</th>';
        });
  			tbl_res +='</tr>';
  		tbl_res +='</thead>';
  		tbl_res +='<tbody>';

  			//--->create table body rows > start
  			$.each(ajax_res_data, function(index, val) //for each row of the data
  			{
  				//you can replace with your database row id
  				var row_id = random_id();

  				//loop through ajax row data
  				tbl_res +='<tr row_id="'+val[indx]+'">';
            $.each( ajax_res_cols, function( index, value ){  //for each col of the data
              //console.log("PRINTNOTEDIT",value)
              tbl_res +='<td ><div class="not_edit" col_name="'+value+'" contentEditable="false" readonly>'+val[value]+'</div></td>';
              	//--->  tbl += '<th>'+value+'</th>';
            });
  				tbl_res+='</tr>';
  			});

  			//--->create table body rows > end
  		tbl_res +='</tbody>';
  		//--->create table body > end
  	tbl_res +='</table>'
    return tbl_res
  }




  var tbl_res = create_res(ajax_res_cols,ajax_res_data)
	//out put table data
	$(document).find('.tbl_user_data').html(tbl);
  $(document).find('.tbl_res_data').html(tbl_res);



	//--->make div editable > start
	$(document).on('click', '.row_data', function(event)
	{
		event.preventDefault();

		if($(this).attr('edit_type') == 'button')
		{
			return false;
		}

		//make div editable
		$(this).closest('div').attr('contenteditable', 'true');
		//add bg css
		$(this).addClass('bg-warning').css('padding','5px');

		$(this).focus();
	})
	//--->make div editable > end


	//--->save single field data > start
	$(document).on('focusout', '.row_data', function(event)
	{
		event.preventDefault();

		if($(this).attr('edit_type') == 'button')
		{
			return false;
		}

		var row_id = $(this).closest('tr').attr('row_id');

		var row_div = $(this)
		.removeClass('bg-warning') //add bg css
		.css('padding','')

		var col_name = row_div.attr('col_name');
		var col_val = row_div.html();

		var arr = {};
		arr["edit"] = col_val;

		//use the "arr"	object for your ajax call
		$.extend(arr, {row_id:row_id});

    console.log('PRINTLOG',arr, row_id)

    var data = {
        "name": "test",
        "age": 1
    };

   $.ajax({
   type: 'POST',
   url: 'http://127.0.0.1:3000/update',
   data: JSON.stringify(arr),
   contentType: 'application/json; charset=UTF-8',
   dataType: 'json',
   success: function(data){
     console.log(data)
     var tbl_res = create_res(JSON.parse(data['ajax_res_cols']),JSON.parse(data['ajax_res_data']));
                  $(document).find('.tbl_res_data').html(tbl_res);

   },
   error: function(err) {
       console.log("lose");
   }
});

    //$.post( ; charset=UTF-8
    //          "/display",
    //          { arr: arr,col_name:col_name})
		//out put to show
		$('.post_msg').html( '<pre class="bg-success">'+JSON.stringify(arr, null, 2) +'</pre>');

	})
	//--->save single field data > end


	//--->button > edit > start

	//--->button > edit > end


	//--->button > cancel > start

	//--->button > cancel > end


	//--->save whole row entery > start

	//--->save whole row entery > end


});
</script>

<!-- <div id="scrolldiv1">{{ res_df|safe }}</div> -->

<div class="panel panel-default">
  <div class="panel-heading"><b> Result </b> </div>

  <div class="panel-body">

	<div class="tbl_res_data"></div>

  </div>
</div>


<div class="panel panel-default">
  <div class="panel-heading"><b> Demo </b> </div>

  <div class="panel-body">

	<div class="tbl_user_data"></div>

  </div>

</div>




{% endblock %}
